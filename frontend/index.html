<!doctype html>
<html>
<head><meta charset="utf-8"><title>Mini Shop</title></head>
<body>
<h1>Mini Shop (Demo)</h1>
<div id="auth">
  <input id="u" placeholder="username"/><input id="p" placeholder="password" type="password"/>
  <button onclick="register()">Register</button>
  <button onclick="login()">Login</button>
</div>
<div id="actions" style="display:none">
  <button onclick="listProducts()">List Products</button>
  <button onclick="viewCart()">View Cart</button>
  <button onclick="addToCart()">Add 1st Product (x2)</button>
  <button onclick="checkout()">Checkout</button>
  <pre id="out"></pre>
</div>
<script>
let token = '';
async function register() {
  const u=document.getElementById('u').value; const p=document.getElementById('p').value;
  const r=await fetch('/api/user/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
  document.getElementById('out').innerText = await r.text();
}
async function login() {
  const u=document.getElementById('u').value; const p=document.getElementById('p').value;
  const r=await fetch('/api/user/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
  const j=await r.json(); token=j.token; if(token){document.getElementById('actions').style.display='block';}
  document.getElementById('out').innerText = JSON.stringify(j,null,2);
}
async function listProducts() {
  const r=await fetch('/api/product/products'); const j=await r.json();
  document.getElementById('out').innerText = JSON.stringify(j,null,2);
}
async function addToCart() {
  const r=await fetch('/api/product/products'); const products=await r.json();
  if(!products.length){document.getElementById('out').innerText='No products';return;}
  const first=products[0];
  const res=await fetch('/api/cart/cart/add',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({productId:first.id,quantity:2})});
  document.getElementById('out').innerText = await res.text();
}
async function viewCart() {
  const r=await fetch('/api/cart/cart',{headers:{Authorization:'Bearer '+token}});
  const j=await r.json(); document.getElementById('out').innerText = JSON.stringify(j,null,2);
}
async function checkout() {
  const r=await fetch('/api/order/orders',{method:'POST',headers:{Authorization:'Bearer '+token}});
  const j=await r.json(); document.getElementById('out').innerText = JSON.stringify(j,null,2);
}
</script>
</body>
</html>
